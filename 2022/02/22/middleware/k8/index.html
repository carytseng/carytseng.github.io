<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  
  <title>K8S | Cary Tseng</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  
    <meta name="author" content="CaryTseng">
  
  
    <meta name="description" content="概念
Service​    一类服务，有name，虚拟ip和port，提供远程能力
#### 三种IP


Node IP：Node节点的IP地址，真实的物理机网卡的ip地址。
Pod IP：Pod的IP地址，docker0网桥分配的ip。
Cluster IP：Service的IP地址，虚拟的ip，无法ping，由Kubernetes管理分配。

外部系统访问Service的方式，通过Node">
  
  <meta name="description" content="概念 Service​    一类服务，有name，虚拟ip和port，提供远程能力 #### 三种IP   Node IP：Node节点的IP地址，真实的物理机网卡的ip地址。 Pod IP：Pod的IP地址，docker0网桥分配的ip。 Cluster IP：Service的IP地址，虚拟的ip，无法ping，由Kubernetes管理分配。  外部系统访问Service的方式，通过Node">
<meta property="og:type" content="article">
<meta property="og:title" content="K8S">
<meta property="og:url" content="https://dogfun.top/2022/02/22/middleware/k8/index.html">
<meta property="og:site_name" content="Cary Tseng">
<meta property="og:description" content="概念 Service​    一类服务，有name，虚拟ip和port，提供远程能力 #### 三种IP   Node IP：Node节点的IP地址，真实的物理机网卡的ip地址。 Pod IP：Pod的IP地址，docker0网桥分配的ip。 Cluster IP：Service的IP地址，虚拟的ip，无法ping，由Kubernetes管理分配。  外部系统访问Service的方式，通过Node">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://img.orchome.com/group1/M00/00/03/dr5oXFv0K4eAMuaUAACvvKRWv6A962.png">
<meta property="article:published_time" content="2022-02-22T03:24:58.000Z">
<meta property="article:modified_time" content="2022-03-29T02:41:36.389Z">
<meta property="article:author" content="CaryTseng">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img.orchome.com/group1/M00/00/03/dr5oXFv0K4eAMuaUAACvvKRWv6A962.png">
  
    <link rel="alternate" href="/atom.xml" title="Cary Tseng" type="application/atom+xml">
  
  
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
  
  
<link rel="stylesheet" href="/css/style.css">

  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div class="wrapper">
    <header id="header">
  <div class="title">
    <h1><a href="/">Cary Tseng</a></h1>
    <p><a href="/"></a></p>
  </div>
  <nav class="nav">
    <ul>
      
        <li><a href="/">Home</a></li>
      
        <li><a href="/archives">Archives</a></li>
      
      
        <li><a href="/atom.xml">RSS</a></li>
      
    </ul>
    <div class="clearfix"></div>
  </nav>
  <div class="clearfix"></div>
</header>
    <div class="content"><article class="post">
  <header>
    
      <div class="icon"></div>
      <a href="/2022/02/22/middleware/k8/">
  <time datetime="2022-02-22T03:24:58.000Z">
    2022-02-22
  </time>
</a>
    
    
  
    <h1 class="title">K8S</h1>
  

  </header>
  
  <div class="entry">
    
      <h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p><img src="https://img.orchome.com/group1/M00/00/03/dr5oXFv0K4eAMuaUAACvvKRWv6A962.png" alt="Pod、RC与Service的关系"></p>
<h3 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h3><p>​    一类服务，有name，虚拟ip和port，提供远程能力</p>
<pre><code>#### 三种IP
</code></pre>
<ul>
<li>Node IP：Node节点的IP地址，真实的物理机网卡的ip地址。</li>
<li>Pod IP：Pod的IP地址，docker0网桥分配的ip。</li>
<li>Cluster IP：Service的IP地址，虚拟的ip，无法ping，由Kubernetes管理分配。</li>
</ul>
<p>外部系统访问Service的方式，通过NodePort暴露出来</p>
<h3 id="Pod"><a href="#Pod" class="headerlink" title="Pod"></a>Pod</h3><p>​    以<em>Pod</em>为最小单位来调度并管理<em>Docker</em>容器<em>（Container）</em>，其中1个<em>Pod</em>可含多个容器，且相同<em>Pod</em>里的容器共享本地网络，容器间可通过<em>localhost</em>地址互访，即容器如同部署在相同的主机上，而以<em>Pod</em>为最小单元来调度则表明：<em>Pod</em>内的容器被调度到相同的<em>Docker</em>节点上。</p>
<p>Service于Pod的关系，即可理解为Pod是Service一类服务定义的运行实例</p>
<h3 id="Deployment"><a href="#Deployment" class="headerlink" title="Deployment"></a>Deployment</h3><p>​    将应用直接以<em>Pod</em>形式部署很少见，主因是：<em>Pod</em>无法提供弹性伸缩，且节点故障时<em>K8S</em>无法将其调度到幸存节点上，缺少自愈能力。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get deploy -o wide</span><br></pre></td></tr></table></figure>

<h2 id="我的理解"><a href="#我的理解" class="headerlink" title="我的理解"></a>我的理解</h2><p>​    Pod是服务实例运行的最小单元（pause容器+业务容器），Service用来暴露服务，通过label来负载均衡到pod集群上，RC保证service的服务能力，根据情况进行调度与监控。每个Service分配一个ClusterIP，属于Kubernetes集群内的虚拟ip，pod的地址会随着伸缩而变化注册到service，但service是不变的，类似注册中心的作用。Deployment用来定义服务的，定义副本数量</p>
<h2 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"># 创建pod</span><br><span class="line">kubectl create -f /tmp/myhttpd.pod </span><br><span class="line"></span><br><span class="line"># 查看pod</span><br><span class="line">kubectl get pod</span><br><span class="line"></span><br><span class="line"># 查看pod的ip</span><br><span class="line">kubectl describe pod myhttp|grep IP</span><br><span class="line"></span><br><span class="line"># 集群所有node</span><br><span class="line">kubectl get nodes</span><br><span class="line"></span><br><span class="line"># 节点详情</span><br><span class="line">kubectl describe node 127.0.0.1</span><br><span class="line"></span><br><span class="line"># 获取所有部署</span><br><span class="line">kubectl get deployments</span><br><span class="line"></span><br><span class="line"># 查看所有 pod 列表,  -n 后跟 namespace, 查看指定的命名空间</span><br><span class="line">kubectl get pod</span><br><span class="line">kubectl get pod -n kube  </span><br><span class="line">kubectl get pod -o wide</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 查看 RC 和 service 列表， -o wide 查看详细信息</span><br><span class="line">kubectl get rc,svc</span><br><span class="line">kubectl get pod,svc -o wide  </span><br><span class="line">kubectl get pod &lt;pod-name&gt; -o yaml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 显示 Node 的详细信息</span><br><span class="line">kubectl describe node 192.168.0.212</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 显示 Pod 的详细信息, 特别是查看 pod 无法创建的时候的日志</span><br><span class="line">kubectl describe pod &lt;pod-name&gt;</span><br><span class="line">eg:</span><br><span class="line">kubectl describe pod redis-master-tqds9</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 根据 yaml 创建资源, apply 可以重复执行，create 不行</span><br><span class="line">kubectl create -f pod.yaml</span><br><span class="line">kubectl apply -f pod.yaml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 基于 pod.yaml 定义的名称删除 pod </span><br><span class="line">kubectl delete -f pod.yaml </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 删除所有包含某个 label 的pod 和 service</span><br><span class="line">kubectl delete pod,svc -l name=&lt;label-name&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 删除所有 Pod</span><br><span class="line">kubectl delete pod --all</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 查看 endpoint 列表</span><br><span class="line">kubectl get endpoints</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 执行 pod 的 date 命令</span><br><span class="line">kubectl exec &lt;pod-name&gt; -- date</span><br><span class="line">kubectl exec &lt;pod-name&gt; -- bash</span><br><span class="line">kubectl exec &lt;pod-name&gt; -- ping 10.24.51.9</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 通过bash获得 pod 中某个容器的TTY，相当于登录容器</span><br><span class="line">kubectl exec -it &lt;pod-name&gt; -c &lt;container-name&gt; -- bash</span><br><span class="line">eg:</span><br><span class="line">kubectl exec -it redis-master-cln81 -- bash</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 查看容器的日志</span><br><span class="line">kubectl logs &lt;pod-name&gt;</span><br><span class="line">kubectl logs -f &lt;pod-name&gt; # 实时查看日志</span><br><span class="line">kubectl log  &lt;pod-name&gt;  -c &lt;container_name&gt; # 若 pod 只有一个容器，可以不加 -c </span><br><span class="line"></span><br><span class="line">kubectl logs -l app=frontend # 返回所有标记为 app=frontend 的 pod 的合并日志。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 查看注释</span><br><span class="line">kubectl explain pod</span><br><span class="line">kubectl explain pod.apiVersion</span><br><span class="line"></span><br><span class="line"># 查看节点 labels</span><br><span class="line">kubectl get node --show-labels</span><br><span class="line"></span><br><span class="line"># 重启 pod</span><br><span class="line">kubectl get pod &lt;POD名称&gt; -n &lt;NAMESPACE名称&gt; -o yaml | kubectl replace --force -f -</span><br><span class="line"></span><br><span class="line"># 修改网络类型</span><br><span class="line">kubectl patch service istio-ingressgateway -n istio-system -p &#x27;&#123;&quot;spec&quot;:&#123;&quot;type&quot;:&quot;NodePort&quot;&#125;&#125;&#x27;</span><br><span class="line"></span><br><span class="line"># 伸缩 pod 副本</span><br><span class="line"># 可用于将Deployment及其Pod缩小为零个副本，实际上杀死了所有副本。当您将其缩放回1/1时，将创建一个新的Pod，重新启动您的应用程序。</span><br><span class="line">kubectl scale deploy/nginx-1 --replicas=0</span><br><span class="line">kubectl scale deploy/nginx-1 --replicas=1</span><br><span class="line"></span><br><span class="line"># 查看前一个 pod 的日志，logs -p 选项 </span><br><span class="line">kubectl logs --tail 100 -p user-klvchen-v1.0-6f67dcc46b-5b4qb &gt; pre.log</span><br></pre></td></tr></table></figure>


    
  </div>
  <footer>
    
      
  <div class="categories">
    <a class="categories-link" href="/categories/middleware/">middleware</a>
  </div>

      
    
    <div class="clearfix"></div>
  </footer>
</article>

</div>
  </div>
  <footer id="footer"><div class="copyright">
  
  &copy; 2022 <a href="/">CaryTseng</a>
  
</div>
<div class="theme-copyright">
  Theme by <a href="https://github.com/orderedlist" target="_blank">orderedlist</a>
   | 
  Redesign by <a href="http://heroicyang.com/" target="_blank">Heroic Yang</a>
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
<script src="/js/scale.fix.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
  (function($){
    $('.fancybox').fancybox();
  })(jQuery);
</script>

</body>
</html>